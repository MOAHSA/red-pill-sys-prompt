<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>باني النصوص المرئي | Visual Prompt Builder</title>
    <style>
        :root {
            --bg-primary: #1a1a1a;
            --bg-secondary: #2d2d2d;
            --bg-tertiary: #3d3d3d;
            --text-primary: #ffffff;
            --text-secondary: #b3b3b3;
            --accent-primary: #4CAF50;
            --accent-secondary: #45a049;
            --border-color: #404040;
            --shadow-color: rgba(0, 0, 0, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--bg-primary);
            min-height: 100vh;
            padding: 20px;
            font-size: 14px;
            color: var(--text-primary);
        }

        .container {
            max-width: 1300px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 280px 1fr;
            gap: 15px;
            height: calc(100vh - 40px);
        }

        .blocks-panel {
            background: var(--bg-secondary);
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 4px var(--shadow-color);
            overflow-y: auto;
            font-size: 0.95em;
            border: 1px solid var(--border-color);
        }

        .workspace {
            background: var(--bg-secondary);
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 4px var(--shadow-color);
            position: relative;
            overflow-y: auto;
            font-size: 0.95em;
            border: 1px solid var(--border-color);
            transform-origin: top left;
            transition: transform 0.3s ease;
        }

        .workspace * {
            transform-origin: inherit;
        }

        .block {
            background: var(--bg-tertiary);
            border: 2px solid var(--accent-primary);
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 10px;
            cursor: move;
            user-select: none;
            transition: all 0.3s ease;
            width: 260px;
            font-size: 0.95em;
            color: var(--text-primary);
            position: relative;
            transform-origin: inherit;
        }

        .block * {
            transform-origin: inherit;
        }

        .block:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .block-header {
            font-size: 1.05em;
            margin-bottom: 10px;
            color: var(--accent-primary);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .block-content {
            display: flex;
            flex-direction: column;
            gap: 8px;
            transform-origin: inherit;
        }

        .input-field {
            font-size: 0.95em;
            padding: 8px;
            margin-bottom: 8px;
            width: 100%;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background: var(--bg-secondary);
            color: var(--text-primary);
            transform-origin: inherit;
        }

        .input-field:focus {
            outline: none;
            border-color: var(--accent-primary);
        }

        .output-panel {
            position: absolute;
            bottom: 20px;
            left: 20px;
            right: 20px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 15px;
        }

        .output-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: var(--text-primary);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        #finalPrompt {
            width: 100%;
            min-height: 100px;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background: var(--bg-tertiary);
            resize: vertical;
            font-size: 14px;
            color: var(--text-primary);
        }

        .category {
            margin-bottom: 20px;
        }

        .category-title {
            font-weight: bold;
            color: var(--text-primary);
            margin-bottom: 8px;
            padding-bottom: 4px;
            border-bottom: 2px solid var(--accent-primary);
            font-size: 1.05em;
        }

        .button {
            background: var(--accent-primary);
            color: var(--text-primary);
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px var(--shadow-color);
            text-align: center;
            min-width: 100px;
        }

        .button:hover {
            background: var(--accent-secondary);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px var(--shadow-color);
        }

        .delete-btn {
            background: #ff4444;
            color: var(--text-primary);
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px var(--shadow-color);
        }

        .delete-btn:hover {
            background: #cc0000;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px var(--shadow-color);
        }

        .controls {
            display: flex;
            gap: 12px;
            margin-bottom: 15px;
            padding: 10px;
            background: var(--bg-tertiary);
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        .action-buttons {
            display: flex;
            gap: 12px;
            margin-top: 15px;
            padding: 10px;
            background: var(--bg-tertiary);
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        .block[data-type="system"] {
            border-color: #2196F3;
        }

        .block[data-type="system"] .block-header {
            color: #2196F3;
        }

        .block[data-type="context"] {
            border-color: #9C27B0;
        }

        .block[data-type="context"] .block-header {
            color: #9C27B0;
        }

        .block[data-type="instruction"] {
            border-color: #FF9800;
        }

        .block[data-type="instruction"] .block-header {
            color: #FF9800;
        }

        .block[data-type="example"] {
            border-color: #607D8B;
        }

        .block[data-type="example"] .block-header {
            color: #607D8B;
        }

        .block[data-type="data"] {
            border-color: #795548;
        }

        .block[data-type="data"] .block-header {
            color: #795548;
        }

        .language-switch {
            position: fixed;
            top: 20px;
            right: 150px;
            background: var(--bg-secondary);
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            z-index: 1000;
            border: 1px solid var(--border-color);
        }

        .data-preview {
            margin-top: 10px;
            padding: 10px;
            background: var(--bg-tertiary);
            border-radius: 4px;
            font-size: 12px;
            max-height: 100px;
            overflow-y: auto;
        }

        .prompt-library {
            position: fixed;
            top: 80px;
            left: 20px;
            background: var(--bg-secondary);
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px var(--shadow-color);
            z-index: 1000;
            max-width: 320px;
            max-height: calc(100vh - 120px);
            overflow-y: auto;
            border: 1px solid var(--border-color);
        }

        .prompt-library h3 {
            color: var(--accent-primary);
            font-size: 1.2em;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--accent-primary);
            text-align: center;
        }

        .prompt-category {
            margin-bottom: 20px;
            background: var(--bg-tertiary);
            border-radius: 8px;
            padding: 15px;
            border: 1px solid var(--border-color);
        }

        .prompt-category-title {
            font-weight: 600;
            color: var(--text-primary);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px;
            background: var(--bg-secondary);
            border-radius: 6px;
            transition: all 0.3s ease;
        }

        .category-icon {
            font-size: 1.4em;
        }

        .category-description {
            font-size: 0.9em;
            color: var(--text-secondary);
            margin-right: auto;
        }

        .prompt-item {
            padding: 12px;
            margin: 10px 0;
            background: var(--bg-secondary);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid var(--border-color);
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }

        .prompt-info {
            flex: 1;
        }

        .prompt-name {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .prompt-description {
            font-size: 0.9em;
            color: var(--text-secondary);
        }

        .prompt-item:hover {
            background: var(--accent-primary);
            transform: translateX(5px);
            box-shadow: 0 2px 8px var(--shadow-color);
        }

        .prompt-item:hover .prompt-name,
        .prompt-item:hover .prompt-description {
            color: var(--text-primary);
        }

        .prompt-search {
            margin-bottom: 20px;
            position: relative;
        }

        .prompt-search input {
            width: 100%;
            padding: 12px 40px 12px 15px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            background: var(--bg-tertiary);
            color: var(--text-primary);
            font-size: 1em;
        }

        .prompt-search input:focus {
            border-color: var(--accent-primary);
            outline: none;
            box-shadow: 0 0 0 2px rgba(76, 175, 80, 0.2);
        }

        .prompt-search::after {
            content: '🔍';
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.2em;
            color: var(--text-secondary);
        }

        .prompt-preview {
            margin-top: 8px;
            padding: 8px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 0.9em;
            max-height: 120px;
            overflow-y: auto;
            color: var(--text-primary);
        }

        .category-content {
            display: none;
            padding-right: 10px;
        }

        .category-content.active {
            display: block;
        }

        .toggle-icon {
            transition: transform 0.3s ease;
        }

        .category-content.active + .toggle-icon {
            transform: rotate(180deg);
        }

        .help-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--accent-primary);
            color: var(--text-primary);
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: 600;
            z-index: 1001;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 2px 4px var(--shadow-color);
            transition: all 0.3s ease;
        }

        .help-toggle:hover {
            background: var(--accent-secondary);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px var(--shadow-color);
        }

        .help-toggle .icon {
            font-size: 1.2em;
        }

        .help-toggle .text {
            font-weight: 500;
        }

        .help-section {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--bg-secondary);
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 1000;
            max-width: 700px;
            width: 90%;
            max-height: 85vh;
            overflow-y: auto;
            display: none;
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .help-section.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translate(-50%, -48%);
            }
            to {
                opacity: 1;
                transform: translate(-50%, -50%);
            }
        }

        .help-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            z-index: 999;
            display: none;
        }

        .help-overlay.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        .help-close {
            position: absolute;
            top: 12px;
            left: 12px;
            background: #ff4444;
            color: var(--text-primary);
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px var(--shadow-color);
        }

        .help-close:hover {
            background: #cc0000;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px var(--shadow-color);
        }

        .help-close .icon {
            font-size: 1.1em;
        }

        @media (max-width: 1200px) {
            .container {
                grid-template-columns: 240px 1fr;
            }
            
            .block {
                width: 240px;
            }
        }

        @media (max-width: 768px) {
            .container {
                grid-template-columns: 1fr;
            }
            
            .blocks-panel {
                position: fixed;
                left: -280px;
                top: 0;
                height: 100vh;
                z-index: 1000;
                transition: left 0.3s ease;
            }
            
            .blocks-panel.active {
                left: 0;
            }
            
            .block {
                width: 100%;
            }
        }

        /* Add navigation styles */
        .nav-buttons {
            position: fixed;
            top: 20px;
            left: 20px;
            display: flex;
            gap: 10px;
            z-index: 1000;
        }

        .nav-button {
            background: var(--accent-primary);
            color: var(--text-primary);
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 2px 4px var(--shadow-color);
            min-width: 120px;
            justify-content: center;
        }

        .nav-button:hover {
            background: var(--accent-secondary);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px var(--shadow-color);
        }

        .nav-button.active {
            background: var(--accent-secondary);
            box-shadow: 0 4px 8px var(--shadow-color);
            border: 2px solid var(--text-primary);
        }

        /* Add zoom controls */
        .zoom-controls {
            position: fixed;
            bottom: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 1000;
            background: var(--bg-secondary);
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 4px var(--shadow-color);
            border: 1px solid var(--border-color);
        }

        .zoom-btn {
            background: var(--accent-primary);
            color: var(--text-primary);
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1.2em;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px var(--shadow-color);
        }

        .zoom-btn:hover {
            background: var(--accent-secondary);
            transform: translateY(-2px);
        }

        /* Connection lines */
        .connection-line {
            position: absolute;
            background: var(--accent-primary);
            height: 2px;
            transform-origin: left center;
            pointer-events: none;
            z-index: 1;
        }

        .connection-point {
            position: absolute;
            width: 10px;
            height: 10px;
            background: var(--accent-primary);
            border-radius: 50%;
            cursor: pointer;
            z-index: 2;
        }

        .connection-point:hover {
            transform: scale(1.2);
        }

        .block .connection-points {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            pointer-events: none;
        }

        .block .connection-point {
            pointer-events: auto;
        }

        .block .connection-point.top {
            top: -5px;
            left: 50%;
            transform: translateX(-50%);
        }

        .block .connection-point.bottom {
            bottom: -5px;
            left: 50%;
            transform: translateX(-50%);
        }

        .block .connection-point.left {
            left: -5px;
            top: 50%;
            transform: translateY(-50%);
        }

        .block .connection-point.right {
            right: -5px;
            top: 50%;
            transform: translateY(-50%);
        }
    </style>
</head>
<body>
    <div class="nav-buttons">
        <button class="nav-button active" onclick="window.location.href='../prompt-builder/index.html'">
            <span>باني النصوص</span>
        </button>
        <button class="nav-button" onclick="window.location.href='../public/index.html'">
            <span>الواجهة الرئيسية</span>
        </button>
    </div>
    <div class="help-overlay" id="helpOverlay"></div>
    
    <button class="help-toggle" onclick="toggleHelp()">
        <span class="icon">❓</span>
        <span class="text" data-ar="المساعدة" data-en="Help">المساعدة</span>
    </button>
    
    <div class="help-section" id="helpSection">
        <button class="help-close" onclick="toggleHelp()">
            <span class="icon">×</span>
            <span data-ar="إغلاق" data-en="Close">إغلاق</span>
        </button>
        <div class="help-content">
            <h2 data-ar="دليل استخدام باني النصوص المرئي" data-en="Visual Prompt Builder Guide">دليل استخدام باني النصوص المرئي</h2>
            
            <h3 data-ar="المقدمة" data-en="Introduction">المقدمة</h3>
            <p data-ar="باني النصوص المرئي هو أداة تساعدك على إنشاء وتنظيم النصوص البرمجية بشكل مرئي وسهل. يمكنك استخدامه لبناء نصوص متعددة الحبوب وتنظيمها بطريقة منطقية." data-en="The Visual Prompt Builder is a tool that helps you create and organize prompts visually and easily. You can use it to build multi-pill prompts and organize them logically.">باني النصوص المرئي هو أداة تساعدك على إنشاء وتنظيم النصوص البرمجية بشكل مرئي وسهل. يمكنك استخدامه لبناء نصوص متعددة الحبوب وتنظيمها بطريقة منطقية.</p>
            
            <h3 data-ar="كيفية الاستخدام" data-en="How to Use">كيفية الاستخدام</h3>
            <ol>
                <li data-ar="اختر البرومبت المناسب من المكتبة على اليمين" data-en="Choose the appropriate prompt from the library on the right">اختر البرومبت المناسب من المكتبة على اليمين</li>
                <li data-ar="اسحب البرومبت إلى مساحة العمل" data-en="Drag the prompt to the workspace">اسحب البرومبت إلى مساحة العمل</li>
                <li data-ar="املأ المعاملات المطلوبة في البرومبت" data-en="Fill in the required parameters in the prompt">املأ المعاملات المطلوبة في البرومبت</li>
                <li data-ar="شاهد النتيجة النهائية في المربع السفلي" data-en="View the final result in the bottom box">شاهد النتيجة النهائية في المربع السفلي</li>
            </ol>
            
            <h3 data-ar="الميزات الرئيسية" data-en="Key Features">الميزات الرئيسية</h3>
            <ul>
                <li data-ar="مكتبة برومبتات جاهزة" data-en="Ready-made prompt library">مكتبة برومبتات جاهزة</li>
                <li data-ar="سحب وإفلات البرومبتات" data-en="Drag and drop prompts">سحب وإفلات البرومبتات</li>
                <li data-ar="تعديل المعاملات بسهولة" data-en="Easy parameter modification">تعديل المعاملات بسهولة</li>
                <li data-ar="حفظ وتحميل البرومبتات" data-en="Save and load prompts">حفظ وتحميل البرومبتات</li>
                <li data-ar="نسخ النتيجة النهائية" data-en="Copy final result">نسخ النتيجة النهائية</li>
            </ul>
            
            <h3 data-ar="نصائح للاستخدام" data-en="Usage Tips">نصائح للاستخدام</h3>
            <ul>
                <li data-ar="استخدم البرومبتات الجاهزة كقوالب" data-en="Use ready-made prompts as templates">استخدم البرومبتات الجاهزة كقوالب</li>
                <li data-ar="قم بتنظيم البرومبتات بشكل منطقي" data-en="Organize prompts logically">قم بتنظيم البرومبتات بشكل منطقي</li>
                <li data-ar="احفظ عملك بشكل دوري" data-en="Save your work periodically">احفظ عملك بشكل دوري</li>
                <li data-ar="استخدم ميزة النسخ للنتائج النهائية" data-en="Use the copy feature for final results">استخدم ميزة النسخ للنتائج النهائية</li>
            </ul>
        </div>
    </div>
    <div class="language-switch">
        <button class="button" onclick="toggleLanguage()">English | العربية</button>
    </div>
    <div class="prompt-library">
        <h3 data-ar="مكتبة البرومبتات" data-en="Prompt Library">مكتبة البرومبتات</h3>
        <div id="promptCategories"></div>
    </div>
    <div class="container">
        <div class="blocks-panel">
            <div class="category">
                <div class="category-title" data-ar="بلوكات النظام" data-en="System Blocks">System Blocks</div>
                <div class="block" draggable="true" data-type="system">
                    <div class="block-header">
                        <span data-ar="دور النظام" data-en="System Role">System Role</span>
                        <button class="delete-btn">×</button>
                    </div>
                    <div class="block-content">
                        <select class="input-field">
                            <option value="">Select role...</option>
                            <option value="أنت خبير">خبير</option>
                            <option value="أنت معلم">معلم</option>
                            <option value="أنت كاتب إبداعي">كاتب إبداعي</option>
                            <option value="أنت مساعد تقني">مساعد تقني</option>
                        </select>
                        <input type="text" class="input-field" placeholder="تفاصيل إضافية للدور...">
                    </div>
                </div>
            </div>
            <div class="category">
                <div class="category-title" data-ar="بلوكات السياق" data-en="Context Blocks">Context Blocks</div>
                <div class="block" draggable="true" data-type="context">
                    <div class="block-header">
                        <span data-ar="السياق" data-en="Context">Context</span>
                        <button class="delete-btn">×</button>
                    </div>
                    <div class="block-content">
                        <textarea class="input-field" placeholder="أدخل معلومات السياق..." rows="3"></textarea>
                    </div>
                </div>
            </div>
            <div class="category">
                <div class="category-title" data-ar="بلوكات التعليمات" data-en="Instruction Blocks">Instruction Blocks</div>
                <div class="block" draggable="true" data-type="instruction">
                    <div class="block-header">
                        <span data-ar="التعليمات" data-en="Instruction">Instruction</span>
                        <button class="delete-btn">×</button>
                    </div>
                    <div class="block-content">
                        <select class="input-field">
                            <option value="">اختر النوع...</option>
                            <option value="اكتب">اكتب</option>
                            <option value="اشرح">اشرح</option>
                            <option value="حلل">حلل</option>
                            <option value="قارن">قارن</option>
                            <option value="أنشئ">أنشئ</option>
                        </select>
                        <textarea class="input-field" placeholder="أدخل تفاصيل التعليمات..." rows="3"></textarea>
                    </div>
                </div>
            </div>
            <div class="category">
                <div class="category-title" data-ar="بلوكات البيانات" data-en="Data Blocks">Data Blocks</div>
                <div class="block" draggable="true" data-type="data">
                    <div class="block-header">
                        <span data-ar="البيانات" data-en="Data">Data</span>
                        <button class="delete-btn">×</button>
                    </div>
                    <div class="block-content">
                        <input type="file" class="input-field" accept=".json,.txt,.csv">
                        <div class="data-preview"></div>
                    </div>
                </div>
            </div>
            <div class="category">
                <div class="category-title" data-ar="بلوكات الأمثلة" data-en="Example Blocks">Example Blocks</div>
                <div class="block" draggable="true" data-type="example">
                    <div class="block-header">
                        <span data-ar="مثال" data-en="Example">Example</span>
                        <button class="delete-btn">×</button>
                    </div>
                    <div class="block-content">
                        <textarea class="input-field" placeholder="أدخل مثالاً..." rows="3"></textarea>
                    </div>
                </div>
            </div>
        </div>
        <div class="workspace" id="workspace">
            <div class="controls">
                <button class="button" id="saveBtn" data-ar="حفظ النص" data-en="Save Prompt">Save Prompt</button>
                <button class="button" id="loadBtn" data-ar="تحميل النص" data-en="Load Prompt">Load Prompt</button>
                <button class="button" id="clearBtn" data-ar="مسح المساحة" data-en="Clear Workspace">Clear Workspace</button>
            </div>
            <div class="output-panel">
                <div class="output-title">
                    <span data-ar="النص النهائي" data-en="Generated Prompt">Generated Prompt</span>
                    <button class="button" id="copyBtn" data-ar="نسخ" data-en="Copy">Copy</button>
                </div>
                <textarea id="finalPrompt" readonly></textarea>
            </div>
        </div>
    </div>

    <div class="zoom-controls">
        <button class="zoom-btn" onclick="zoomIn()">+</button>
        <button class="zoom-btn" onclick="zoomOut()">-</button>
        <button class="zoom-btn" onclick="resetZoom()">100%</button>
    </div>

    <script>
        let currentLanguage = 'ar';
        let currentZoom = 1;
        let connections = [];

        function toggleLanguage() {
            currentLanguage = currentLanguage === 'ar' ? 'en' : 'ar';
            document.documentElement.dir = currentLanguage === 'ar' ? 'rtl' : 'ltr';
            updateLanguage();
        }

        function updateLanguage() {
            document.querySelectorAll('[data-ar]').forEach(element => {
                if (element.tagName === 'SPAN') {
                    element.textContent = element.getAttribute(`data-${currentLanguage}`);
                } else if (element.tagName === 'BUTTON') {
                    element.textContent = element.getAttribute(`data-${currentLanguage}`);
                }
            });
        }

        // Drag and drop functionality
        const blocks = document.querySelectorAll('.block');
        const workspace = document.getElementById('workspace');
        const finalPrompt = document.getElementById('finalPrompt');
        const saveBtn = document.getElementById('saveBtn');
        const loadBtn = document.getElementById('loadBtn');
        const clearBtn = document.getElementById('clearBtn');
        const copyBtn = document.getElementById('copyBtn');

        // Initialize blocks with delete functionality
        function initializeBlock(block) {
            const deleteBtn = block.querySelector('.delete-btn');
            if (deleteBtn) {
                deleteBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    block.remove();
                    updatePrompt();
                });
            }

            // Handle file input for data blocks
            const fileInput = block.querySelector('input[type="file"]');
            if (fileInput) {
                fileInput.addEventListener('change', (e) => {
                    const file = e.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = (event) => {
                            const preview = block.querySelector('.data-preview');
                            try {
                                const data = JSON.parse(event.target.result);
                                preview.textContent = JSON.stringify(data, null, 2);
                            } catch {
                                preview.textContent = event.target.result;
                            }
                            updatePrompt();
                        };
                        reader.readAsText(file);
                    }
                });
            }

            // Add connection points
            const connectionPoints = document.createElement('div');
            connectionPoints.className = 'connection-points';
            
            ['top', 'right', 'bottom', 'left'].forEach(position => {
                const point = document.createElement('div');
                point.className = `connection-point ${position}`;
                point.addEventListener('mousedown', (e) => startConnection(e, block, position));
                connectionPoints.appendChild(point);
            });
            
            block.appendChild(connectionPoints);
        }

        blocks.forEach(block => {
            initializeBlock(block);
            block.addEventListener('dragstart', (e) => {
                e.dataTransfer.setData('text/plain', block.outerHTML);
            });
        });

        workspace.addEventListener('dragover', (e) => {
            e.preventDefault();
        });

        workspace.addEventListener('drop', (e) => {
            e.preventDefault();
            const blockHTML = e.dataTransfer.getData('text/plain');
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = blockHTML;
            const newBlock = tempDiv.firstElementChild;
            
            newBlock.style.position = 'absolute';
            newBlock.style.left = `${e.clientX - workspace.getBoundingClientRect().left}px`;
            newBlock.style.top = `${e.clientY - workspace.getBoundingClientRect().top}px`;
            
            workspace.insertBefore(newBlock, workspace.firstChild);
            makeBlockDraggable(newBlock);
            initializeBlock(newBlock);
            updatePrompt();
        });

        function makeBlockDraggable(block) {
            block.addEventListener('mousedown', (e) => {
                if (e.target.classList.contains('input-field') || 
                    e.target.classList.contains('delete-btn') ||
                    e.target.classList.contains('connection-point')) return;
                
                const startX = e.clientX - block.offsetLeft;
                const startY = e.clientY - block.offsetTop;

                function moveBlock(e) {
                    block.style.left = `${e.clientX - startX}px`;
                    block.style.top = `${e.clientY - startY}px`;
                    updateConnections();
                }

                function stopMoving() {
                    document.removeEventListener('mousemove', moveBlock);
                    document.removeEventListener('mouseup', stopMoving);
                    updatePrompt();
                }

                document.addEventListener('mousemove', moveBlock);
                document.addEventListener('mouseup', stopMoving);
            });
        }

        function updatePrompt() {
            const blocks = workspace.querySelectorAll('.block');
            let promptText = '';
            let systemText = '';
            let contextText = '';
            let instructionText = '';
            let exampleText = '';
            let dataText = '';
            let promptTemplateText = '';

            blocks.forEach(block => {
                const type = block.dataset.type;
                
                if (type === 'prompt') {
                    const preview = block.querySelector('.prompt-preview');
                    if (preview) {
                        promptTemplateText += preview.textContent + '\n\n';
                    }
                } else if (type === 'data') {
                    const preview = block.querySelector('.data-preview');
                    if (preview && preview.textContent) {
                        dataText += 'Data:\n' + preview.textContent + '\n\n';
                    }
                } else {
                    const inputs = block.querySelectorAll('.input-field');
                    let blockText = '';
                    
                    inputs.forEach(input => {
                        if (input.value) {
                            blockText += input.value + ' ';
                        }
                    });

                    blockText = blockText.trim();
                    if (blockText) {
                        switch(type) {
                            case 'system':
                                systemText += blockText + '\n';
                                break;
                            case 'context':
                                contextText += blockText + '\n';
                                break;
                            case 'instruction':
                                instructionText += blockText + '\n';
                                break;
                            case 'example':
                                exampleText += 'Example:\n' + blockText + '\n';
                                break;
                        }
                    }
                }
            });

            if (systemText) promptText += systemText + '\n';
            if (contextText) promptText += 'Context:\n' + contextText + '\n';
            if (instructionText) promptText += 'Instructions:\n' + instructionText + '\n';
            if (exampleText) promptText += exampleText;
            if (dataText) promptText += dataText;
            if (promptTemplateText) promptText += 'Prompt Template:\n' + promptTemplateText;

            finalPrompt.value = promptText.trim();
        }

        // Save functionality
        saveBtn.addEventListener('click', () => {
            const promptData = {
                blocks: Array.from(workspace.querySelectorAll('.block')).map(block => ({
                    type: block.dataset.type,
                    position: {
                        left: block.style.left,
                        top: block.style.top
                    },
                    inputs: Array.from(block.querySelectorAll('.input-field')).map(input => input.value),
                    data: block.querySelector('.data-preview')?.textContent || ''
                }))
            };
            
            const blob = new Blob([JSON.stringify(promptData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'prompt-builder-save.json';
            a.click();
            URL.revokeObjectURL(url);
        });

        // Load functionality
        loadBtn.addEventListener('click', () => {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = (e) => {
                const file = e.target.files[0];
                const reader = new FileReader();
                
                reader.onload = (event) => {
                    try {
                        const data = JSON.parse(event.target.result);
                        workspace.innerHTML = '<div class="controls"><button class="button" id="saveBtn" data-ar="حفظ النص" data-en="Save Prompt">Save Prompt</button><button class="button" id="loadBtn" data-ar="تحميل النص" data-en="Load Prompt">Load Prompt</button><button class="button" id="clearBtn" data-ar="مسح المساحة" data-en="Clear Workspace">Clear Workspace</button></div><div class="output-panel"><div class="output-title"><span data-ar="النص النهائي" data-en="Generated Prompt">Generated Prompt</span><button class="button" id="copyBtn" data-ar="نسخ" data-en="Copy">Copy</button></div><textarea id="finalPrompt" readonly></textarea></div>';
                        
                        data.blocks.forEach(blockData => {
                            const block = document.querySelector(`.block[data-type="${blockData.type}"]`).cloneNode(true);
                            block.style.position = 'absolute';
                            block.style.left = blockData.position.left;
                            block.style.top = blockData.position.top;
                            
                            const inputs = block.querySelectorAll('.input-field');
                            blockData.inputs.forEach((value, index) => {
                                if (inputs[index]) inputs[index].value = value;
                            });

                            if (blockData.data) {
                                const preview = block.querySelector('.data-preview');
                                if (preview) preview.textContent = blockData.data;
                            }
                            
                            workspace.insertBefore(block, workspace.firstChild);
                            makeBlockDraggable(block);
                            initializeBlock(block);
                        });
                        
                        updatePrompt();
                        updateLanguage();
                    } catch (error) {
                        alert('Error loading file: ' + error.message);
                    }
                };
                
                reader.readAsText(file);
            };
            
            input.click();
        });

        // Clear workspace
        clearBtn.addEventListener('click', () => {
            if (confirm('Are you sure you want to clear the workspace?')) {
                const blocks = workspace.querySelectorAll('.block');
                blocks.forEach(block => block.remove());
                updatePrompt();
            }
        });

        // Copy to clipboard
        copyBtn.addEventListener('click', () => {
            finalPrompt.select();
            document.execCommand('copy');
            const originalText = copyBtn.textContent;
            copyBtn.textContent = currentLanguage === 'ar' ? 'تم النسخ!' : 'Copied!';
            setTimeout(() => {
                copyBtn.textContent = originalText;
            }, 2000);
        });

        // Add input event listeners to all input fields
        document.addEventListener('input', (e) => {
            if (e.target.classList.contains('input-field')) {
                updatePrompt();
            }
        });

        // Initialize language
        updateLanguage();

        // Function to load prompt library
        function loadPromptLibrary() {
            const prompts = {
                "التحليل والتشخيص": {
                    "icon": "🔍",
                    "description": "أدوات تحليل وتشخيص متقدمة للنصوص والمواقف",
                    "prompts": [
                        {
                            "name": "تحليل النص المتكامل",
                            "description": "تحليل شامل للنص من حيث المضمون والأسلوب والبنية",
                            "template": "قم بتحليل النص التالي بشكل متكامل:\n\n1. المضمون:\n- الفكرة الرئيسية: [الفكرة_الرئيسية]\n- الأفكار الفرعية: [الأفكار_الفرعية]\n- الرسالة: [الرسالة]\n\n2. الأسلوب:\n- النمط: [النمط]\n- اللغة: [اللغة]\n- الألفاظ: [الألفاظ]\n\n3. البنية:\n- التنظيم: [التنظيم]\n- الترابط: [الترابط]\n- التدرج: [التدرج]\n\n4. التأثير:\n- القوة: [القوة]\n- الوضوح: [الوضوح]\n- الإقناع: [الإقناع]"
                        },
                        {
                            "name": "تشخيص الموقف",
                            "description": "تحليل متعمق للموقف وتحديد العناصر الرئيسية",
                            "template": "قم بتشخيص الموقف التالي:\n\n1. وصف الموقف:\n- الحدث: [الحدث]\n- السياق: [السياق]\n- المشاركون: [المشاركون]\n\n2. تحليل المشاعر:\n- المشاعر السائدة: [المشاعر_السائدة]\n- ردود الفعل: [ردود_الفعل]\n- التأثيرات: [التأثيرات]\n\n3. تحليل التفكير:\n- الأفكار الرئيسية: [الأفكار_الرئيسية]\n- الافتراضات: [الافتراضات]\n- المنطق المستخدم: [المنطق]\n\n4. تحليل السلوك:\n- السلوكيات الظاهرة: [السلوكيات]\n- الدوافع: [الدوافع]\n- النتائج: [النتائج]"
                        }
                    ]
                },
                "التطوير والتحسين": {
                    "icon": "🚀",
                    "description": "أدوات تطوير وتحسين المهارات والقدرات",
                    "prompts": [
                        {
                            "name": "خطة التطوير الشخصي",
                            "description": "وضع خطة شاملة للتطوير الشخصي والمهني",
                            "template": "ضع خطة تطوير متكاملة لـ [الهدف]:\n\n1. تحليل الوضع الحالي:\n- الوضع الراهن: [الوضع_الراهن]\n- الموارد المتاحة: [الموارد]\n- المعوقات: [المعوقات]\n\n2. الأهداف والغايات:\n- الهدف الرئيسي: [الهدف_الرئيسي]\n- الأهداف الفرعية: [الأهداف_الفرعية]\n- مؤشرات النجاح: [مؤشرات_النجاح]\n\n3. خطة التنفيذ:\n- الخطوات اليومية: [الخطوات_اليومية]\n- الخطوات الأسبوعية: [الخطوات_الأسبوعية]\n- الخطوات الشهرية: [الخطوات_الشهرية]\n\n4. المتابعة والتقييم:\n- نقاط المراجعة: [نقاط_المراجعة]\n- معايير التقييم: [معايير_التقييم]\n- آليات التعديل: [آليات_التعديل]"
                        }
                    ]
                },
                "الإبداع والابتكار": {
                    "icon": "💡",
                    "description": "أدوات توليد الأفكار الإبداعية والحلول المبتكرة",
                    "prompts": [
                        {
                            "name": "حل المشكلة الإبداعي",
                            "description": "توليد حلول إبداعية للمشكلات المعقدة",
                            "template": "اقترح حلاً إبداعياً للمشكلة التالية:\n\n1. تعريف المشكلة:\n- المشكلة الرئيسية: [المشكلة_الرئيسية]\n- الأعراض: [الأعراض]\n- التأثيرات: [التأثيرات]\n\n2. تحليل الخيارات:\n- الحلول التقليدية: [الحلول_التقليدية]\n- الحلول الإبداعية: [الحلول_الإبداعية]\n- الحلول المبتكرة: [الحلول_المبتكرة]\n\n3. تقييم الحلول:\n- المميزات: [المميزات]\n- العيوب: [العيوب]\n- التكلفة: [التكلفة]\n\n4. خطة التنفيذ:\n- الخطوات: [الخطوات]\n- الموارد: [الموارد]\n- الجدول الزمني: [الجدول_الزمني]"
                        },
                        {
                            "name": "تطوير الأفكار",
                            "description": "تطوير وتحسين الأفكار الإبداعية",
                            "template": "قم بتطوير الفكرة التالية:\n\n1. تعريف الفكرة:\n- المفهوم: [المفهوم]\n- الأهداف: [الأهداف]\n- الفئة المستهدفة: [الفئة_المستهدفة]\n\n2. تحليل الجدوى:\n- الإمكانيات: [الإمكانيات]\n- التحديات: [التحديات]\n- الموارد المطلوبة: [الموارد_المطلوبة]\n\n3. خطة التطوير:\n- المراحل: [المراحل]\n- الخطوات: [الخطوات]\n- الجدول الزمني: [الجدول_الزمني]\n\n4. التقييم:\n- معايير النجاح: [معايير_النجاح]\n- مؤشرات الأداء: [مؤشرات_الأداء]\n- آليات التحسين: [آليات_التحسين]"
                        }
                    ]
                },
                "التفكير النقدي": {
                    "icon": "🧠",
                    "description": "أدوات تحليل وتقييم الأفكار والمواقف بشكل نقدي",
                    "prompts": [
                        {
                            "name": "تحليل متعدد المستويات",
                            "description": "تحليل متعمق للموضوع من عدة زوايا",
                            "template": "قم بتحليل متقدم متعدد المستويات للموضوع التالي:\n\n1. المستوى الأساسي:\n- المفهوم: [المفهوم]\n- المكونات: [المكونات]\n- العلاقات: [العلاقات]\n\n2. المستوى المتوسط:\n- الأنماط: [الأنماط]\n- القواعد: [القواعد]\n- الاستثناءات: [الاستثناءات]\n\n3. المستوى المتقدم:\n- النظريات: [النظريات]\n- الفرضيات: [الفرضيات]\n- التطبيقات: [التطبيقات]\n\n4. المستوى الإبداعي:\n- الابتكارات: [الابتكارات]\n- التحسينات: [التحسينات]\n- التطويرات: [التطويرات]"
                        },
                        {
                            "name": "تقييم الحجج",
                            "description": "تحليل وتقييم الحجج والبراهين",
                            "template": "قم بتقييم الحجة التالية:\n\n1. تحليل الحجة:\n- المقدمة: [المقدمة]\n- البراهين: [البراهين]\n- الاستنتاج: [الاستنتاج]\n\n2. تقييم المنطق:\n- الصحة المنطقية: [الصحة_المنطقية]\n- الثغرات: [الثغرات]\n- الافتراضات: [الافتراضات]\n\n3. تحليل الأدلة:\n- قوة الأدلة: [قوة_الأدلة]\n- الموثوقية: [الموثوقية]\n- الشمولية: [الشمولية]\n\n4. التقييم النهائي:\n- القوة: [القوة]\n- الضعف: [الضعف]\n- التوصيات: [التوصيات]"
                        }
                    ]
                },
                "التواصل والتعبير": {
                    "icon": "💬",
                    "description": "أدوات تحسين مهارات التواصل والتعبير",
                    "prompts": [
                        {
                            "name": "تحسين النص",
                            "description": "تحسين وتطوير النصوص المكتوبة",
                            "template": "اقترح تحسينات متقدمة للنص التالي:\n\n1. تحليل النص:\n- النص الأصلي: [النص_الأصلي]\n- الغرض: [الغرض]\n- الجمهور: [الجمهور]\n\n2. نقاط القوة:\n- المميزات: [المميزات]\n- الإيجابيات: [الإيجابيات]\n- النجاحات: [النجاحات]\n\n3. نقاط التحسين:\n- الضعف: [الضعف]\n- المشاكل: [المشاكل]\n- الثغرات: [الثغرات]\n\n4. التحسينات المقترحة:\n- التعديلات: [التعديلات]\n- الإضافات: [الإضافات]\n- التغييرات: [التغييرات]"
                        },
                        {
                            "name": "تحويل الأسلوب",
                            "description": "تحويل النص إلى أسلوب مختلف",
                            "template": "قم بتحويل النص التالي إلى أسلوب متقدم:\n\n1. النص الأصلي:\n- المحتوى: [المحتوى]\n- الأسلوب: [الأسلوب]\n- الغرض: [الغرض]\n\n2. الأسلوب المستهدف:\n- النمط: [النمط]\n- الخصائص: [الخصائص]\n- المتطلبات: [المتطلبات]\n\n3. التحويل:\n- التعديلات: [التعديلات]\n- الإضافات: [الإضافات]\n- التغييرات: [التغييرات]\n\n4. المراجعة:\n- الدقة: [الدقة]\n- الاتساق: [الاتساق]\n- التأثير: [التأثير]"
                        }
                    ]
                }
            };
            
            displayPromptLibrary(prompts);
        }

        function displayPromptLibrary(data) {
            const categoriesContainer = document.getElementById('promptCategories');
            categoriesContainer.innerHTML = '';

            Object.entries(data).forEach(([category, categoryData]) => {
                const categoryDiv = document.createElement('div');
                categoryDiv.className = 'prompt-category';
                
                const categoryTitle = document.createElement('div');
                categoryTitle.className = 'prompt-category-title';
                categoryTitle.innerHTML = `
                    <span class="category-icon">${categoryData.icon}</span>
                    <span>${category}</span>
                    <span class="category-description">${categoryData.description}</span>
                `;
                categoryTitle.onclick = () => toggleCategory(categoryTitle);
                
                const categoryContent = document.createElement('div');
                categoryContent.className = 'category-content';
                
                categoryData.prompts.forEach(prompt => {
                    const promptItem = document.createElement('div');
                    promptItem.className = 'prompt-item';
                    promptItem.innerHTML = `
                        <span class="prompt-icon">📝</span>
                        <div class="prompt-info">
                            <div class="prompt-name">${prompt.name}</div>
                            <div class="prompt-description">${prompt.description}</div>
                        </div>
                    `;
                    promptItem.setAttribute('data-description', prompt.description);
                    promptItem.onclick = () => loadPrompt(prompt);
                    categoryContent.appendChild(promptItem);
                });
                
                categoryDiv.appendChild(categoryTitle);
                categoryDiv.appendChild(categoryContent);
                categoriesContainer.appendChild(categoryDiv);
            });
        }

        function toggleCategory(categoryTitle) {
            const content = categoryTitle.nextElementSibling;
            content.classList.toggle('active');
        }

        function loadPrompt(prompt) {
            const block = document.createElement('div');
            block.className = 'block';
            block.dataset.type = 'prompt';
            block.style.position = 'absolute';
            block.style.left = '50%';
            block.style.top = '50%';
            block.style.transform = 'translate(-50%, -50%)';
            
            const header = document.createElement('div');
            header.className = 'block-header';
            header.innerHTML = `
                <span>${prompt.name}</span>
                <button class="delete-btn">×</button>
            `;
            
            const content = document.createElement('div');
            content.className = 'block-content';
            
            const parameterEditor = document.createElement('div');
            parameterEditor.className = 'parameter-editor';
            
            const parameters = extractParameters(prompt.template);
            parameters.forEach(param => {
                const paramItem = document.createElement('div');
                paramItem.className = 'parameter-item';
                paramItem.innerHTML = `
                    <div class="parameter-label">${param}</div>
                    <input type="text" class="parameter-input" data-parameter="${param}" placeholder="أدخل قيمة ${param}">
                `;
                parameterEditor.appendChild(paramItem);
            });
            
            const preview = document.createElement('div');
            preview.className = 'prompt-preview';
            preview.textContent = prompt.template;
            
            content.appendChild(parameterEditor);
            content.appendChild(preview);
            
            block.appendChild(header);
            block.appendChild(content);
            
            workspace.insertBefore(block, workspace.firstChild);
            makeBlockDraggable(block);
            initializeBlock(block);
            
            parameterEditor.querySelectorAll('.parameter-input').forEach(input => {
                input.addEventListener('input', () => updatePromptPreview(block, prompt.template));
            });
        }

        function extractParameters(template) {
            const regex = /\[(.*?)\]/g;
            const parameters = [];
            let match;
            
            while ((match = regex.exec(template)) !== null) {
                parameters.push(match[1]);
            }
            
            return [...new Set(parameters)];
        }

        function updatePromptPreview(block, template) {
            const preview = block.querySelector('.prompt-preview');
            const inputs = block.querySelectorAll('.parameter-input');
            let updatedTemplate = template;
            
            inputs.forEach(input => {
                const param = input.dataset.parameter;
                const value = input.value || `[${param}]`;
                updatedTemplate = updatedTemplate.replace(new RegExp(`\\[${param}\\]`, 'g'), value);
            });
            
            preview.textContent = updatedTemplate;
            updatePrompt();
        }

        function loadPromptLibrary() {
            const prompts = {
                "التحليل والتشخيص": {
                    "icon": "🔍",
                    "description": "أدوات تحليل وتشخيص متقدمة للنصوص والمواقف",
                    "prompts": [
                        {
                            "name": "تحليل النص المتكامل",
                            "description": "تحليل شامل للنص من حيث المضمون والأسلوب والبنية",
                            "template": "قم بتحليل النص التالي بشكل متكامل:\n\n1. المضمون:\n- الفكرة الرئيسية: [الفكرة_الرئيسية]\n- الأفكار الفرعية: [الأفكار_الفرعية]\n- الرسالة: [الرسالة]\n\n2. الأسلوب:\n- النمط: [النمط]\n- اللغة: [اللغة]\n- الألفاظ: [الألفاظ]\n\n3. البنية:\n- التنظيم: [التنظيم]\n- الترابط: [الترابط]\n- التدرج: [التدرج]\n\n4. التأثير:\n- القوة: [القوة]\n- الوضوح: [الوضوح]\n- الإقناع: [الإقناع]"
                        },
                        {
                            "name": "تشخيص الموقف",
                            "description": "تحليل متعمق للموقف وتحديد العناصر الرئيسية",
                            "template": "قم بتشخيص الموقف التالي:\n\n1. وصف الموقف:\n- الحدث: [الحدث]\n- السياق: [السياق]\n- المشاركون: [المشاركون]\n\n2. تحليل المشاعر:\n- المشاعر السائدة: [المشاعر_السائدة]\n- ردود الفعل: [ردود_الفعل]\n- التأثيرات: [التأثيرات]\n\n3. تحليل التفكير:\n- الأفكار الرئيسية: [الأفكار_الرئيسية]\n- الافتراضات: [الافتراضات]\n- المنطق المستخدم: [المنطق]\n\n4. تحليل السلوك:\n- السلوكيات الظاهرة: [السلوكيات]\n- الدوافع: [الدوافع]\n- النتائج: [النتائج]"
                        }
                    ]
                },
                "التطوير والتحسين": {
                    "icon": "🚀",
                    "description": "أدوات تطوير وتحسين المهارات والقدرات",
                    "prompts": [
                        {
                            "name": "خطة التطوير الشخصي",
                            "description": "وضع خطة شاملة للتطوير الشخصي والمهني",
                            "template": "ضع خطة تطوير متكاملة لـ [الهدف]:\n\n1. تحليل الوضع الحالي:\n- الوضع الراهن: [الوضع_الراهن]\n- الموارد المتاحة: [الموارد]\n- المعوقات: [المعوقات]\n\n2. الأهداف والغايات:\n- الهدف الرئيسي: [الهدف_الرئيسي]\n- الأهداف الفرعية: [الأهداف_الفرعية]\n- مؤشرات النجاح: [مؤشرات_النجاح]\n\n3. خطة التنفيذ:\n- الخطوات اليومية: [الخطوات_اليومية]\n- الخطوات الأسبوعية: [الخطوات_الأسبوعية]\n- الخطوات الشهرية: [الخطوات_الشهرية]\n\n4. المتابعة والتقييم:\n- نقاط المراجعة: [نقاط_المراجعة]\n- معايير التقييم: [معايير_التقييم]\n- آليات التعديل: [آليات_التعديل]"
                        }
                    ]
                }
            };
            
            displayPromptLibrary(prompts);
        }

        function displayPromptLibrary(data) {
            const categoriesContainer = document.getElementById('promptCategories');
            categoriesContainer.innerHTML = '';

            Object.entries(data).forEach(([category, categoryData]) => {
                const categoryDiv = document.createElement('div');
                categoryDiv.className = 'prompt-category';
                
                const categoryTitle = document.createElement('div');
                categoryTitle.className = 'prompt-category-title';
                categoryTitle.innerHTML = `
                    <span class="category-icon">${categoryData.icon}</span>
                    <span>${category}</span>
                    <span class="category-description">${categoryData.description}</span>
                `;
                categoryTitle.onclick = () => toggleCategory(categoryTitle);
                
                const categoryContent = document.createElement('div');
                categoryContent.className = 'category-content';
                
                categoryData.prompts.forEach(prompt => {
                    const promptItem = document.createElement('div');
                    promptItem.className = 'prompt-item';
                    promptItem.innerHTML = `
                        <span class="prompt-icon">📝</span>
                        <div class="prompt-info">
                            <div class="prompt-name">${prompt.name}</div>
                            <div class="prompt-description">${prompt.description}</div>
                        </div>
                    `;
                    promptItem.setAttribute('data-description', prompt.description);
                    promptItem.onclick = () => loadPrompt(prompt);
                    categoryContent.appendChild(promptItem);
                });
                
                categoryDiv.appendChild(categoryTitle);
                categoryDiv.appendChild(categoryContent);
                categoriesContainer.appendChild(categoryDiv);
            });
        }

        function toggleHelp() {
            const helpSection = document.getElementById('helpSection');
            const helpOverlay = document.getElementById('helpOverlay');
            helpSection.classList.toggle('active');
            helpOverlay.classList.toggle('active');
            document.body.style.overflow = helpSection.classList.contains('active') ? 'hidden' : '';
        }

        document.getElementById('helpOverlay').addEventListener('click', toggleHelp);

        function updateHelpLanguage() {
            const helpElements = document.querySelectorAll('.help-content [data-ar]');
            helpElements.forEach(element => {
                if (element.tagName === 'P' || element.tagName === 'LI') {
                    element.textContent = element.getAttribute(`data-${currentLanguage}`);
                }
            });
        }

        const originalUpdateLanguage = updateLanguage;
        updateLanguage = function() {
            originalUpdateLanguage();
            updateHelpLanguage();
        }

        function zoomIn() {
            if (currentZoom < 2) {
                currentZoom += 0.1;
                updateZoom();
            }
        }

        function zoomOut() {
            if (currentZoom > 0.5) {
                currentZoom -= 0.1;
                updateZoom();
            }
        }

        function resetZoom() {
            currentZoom = 1;
            updateZoom();
        }

        function updateZoom() {
            const scale = `scale(${currentZoom})`;
            workspace.style.transform = scale;
            
            // Apply zoom to all inner elements
            workspace.querySelectorAll('.block').forEach(block => {
                block.style.transform = scale;
                block.querySelectorAll('*').forEach(element => {
                    element.style.transform = scale;
                });
            });
            
            updateConnections();
        }

        // Function to load prompts from Python script
        async function loadPromptsFromFiles() {
            try {
                const response = await fetch('/load-prompts');
                const prompts = await response.json();
                displayPromptLibrary(prompts);
            } catch (error) {
                console.error('Error loading prompts:', error);
                // Fallback to default prompts if loading fails
                loadPromptLibrary();
            }
        }

        // Initialize prompts loading
        loadPromptsFromFiles();

        function startConnection(e, sourceBlock, position) {
            e.stopPropagation();
            
            const line = document.createElement('div');
            line.className = 'connection-line';
            workspace.appendChild(line);
            
            const startPoint = getConnectionPoint(sourceBlock, position);
            let targetBlock = null;
            
            function updateLine(e) {
                const rect = workspace.getBoundingClientRect();
                const x = (e.clientX - rect.left) / currentZoom;
                const y = (e.clientY - rect.top) / currentZoom;
                
                const dx = x - startPoint.x;
                const dy = y - startPoint.y;
                const length = Math.sqrt(dx * dx + dy * dy);
                const angle = Math.atan2(dy, dx) * 180 / Math.PI;
                
                line.style.width = `${length}px`;
                line.style.left = `${startPoint.x}px`;
                line.style.top = `${startPoint.y}px`;
                line.style.transform = `rotate(${angle}deg)`;
            }
            
            function endConnection(e) {
                const target = document.elementFromPoint(e.clientX, e.clientY);
                if (target && target.classList.contains('connection-point')) {
                    targetBlock = target.closest('.block');
                    if (targetBlock && targetBlock !== sourceBlock) {
                        createConnection(sourceBlock, targetBlock, position, target.classList[1]);
                    }
                }
                
                line.remove();
                document.removeEventListener('mousemove', updateLine);
                document.removeEventListener('mouseup', endConnection);
            }
            
            document.addEventListener('mousemove', updateLine);
            document.addEventListener('mouseup', endConnection);
        }

        function getConnectionPoint(block, position) {
            const rect = block.getBoundingClientRect();
            const workspaceRect = workspace.getBoundingClientRect();
            
            const x = (rect.left - workspaceRect.left) / currentZoom;
            const y = (rect.top - workspaceRect.top) / currentZoom;
            const width = rect.width / currentZoom;
            const height = rect.height / currentZoom;
            
            switch(position) {
                case 'top':
                    return { x: x + width/2, y: y };
                case 'right':
                    return { x: x + width, y: y + height/2 };
                case 'bottom':
                    return { x: x + width/2, y: y + height };
                case 'left':
                    return { x: x, y: y + height/2 };
            }
        }

        function createConnection(sourceBlock, targetBlock, sourcePosition, targetPosition) {
            const connection = {
                source: sourceBlock,
                target: targetBlock,
                sourcePosition,
                targetPosition
            };
            
            connections.push(connection);
            updateConnections();
        }

        function updateConnections() {
            // Remove existing lines
            document.querySelectorAll('.connection-line').forEach(line => line.remove());
            
            // Create new lines
            connections.forEach(connection => {
                const line = document.createElement('div');
                line.className = 'connection-line';
                workspace.appendChild(line);
                
                const startPoint = getConnectionPoint(connection.source, connection.sourcePosition);
                const endPoint = getConnectionPoint(connection.target, connection.targetPosition);
                
                const dx = endPoint.x - startPoint.x;
                const dy = endPoint.y - startPoint.y;
                const length = Math.sqrt(dx * dx + dy * dy);
                const angle = Math.atan2(dy, dx) * 180 / Math.PI;
                
                line.style.width = `${length}px`;
                line.style.left = `${startPoint.x}px`;
                line.style.top = `${startPoint.y}px`;
                line.style.transform = `rotate(${angle}deg)`;
            });
        }

        // Update connections when workspace is scrolled
        workspace.addEventListener('scroll', updateConnections);

        // Update connections when window is resized
        window.addEventListener('resize', updateConnections);
    </script>
</body>
</html> 